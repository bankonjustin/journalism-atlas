<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Independent Journalism Atlas</title>
    <link rel="icon" type="image/png" href="Journalism_Atlas_favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hanken+Grotesk:wght@400;500;600;700;800&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --black: #000000;
            --white: #FFFFFF;
            --light-gray: #efeff2;
            --dark-gray: #313131;
            --acid-green: #ceff00;
            --lime-green: #97d600;
        }

        body {
            font-family: 'Hanken Grotesk', sans-serif;
            background-color: var(--light-gray);
            color: var(--dark-gray);
        }

        /* Navigation */
        .top-nav {
            background-color: var(--white);
            border-bottom: 1px solid #ddd;
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .top-nav.scrolled {
            padding: 0.5rem 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo-search {
            display: flex;
            align-items: center;
            gap: 2rem;
            flex: 1;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            color: var(--black);
            transition: all 0.3s ease;
        }

        .nav-logo img {
            height: 40px;
            width: auto;
            transition: all 0.3s ease;
        }

        .top-nav.scrolled .nav-logo img {
            height: 32px;
        }

        .nav-search-container {
            position: relative;
            flex: 1;
            max-width: 500px;
        }

        .nav-search {
            width: 100%;
            padding: 0.625rem 1rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: 'Hanken Grotesk', sans-serif;
            font-size: 15px;
            transition: all 0.2s;
        }

        .nav-search:focus {
            outline: none;
            border-color: var(--acid-green);
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-link {
            color: var(--dark-gray);
            text-decoration: none;
            font-size: 15px;
            font-weight: 500;
            white-space: nowrap;
            transition: color 0.2s;
        }

        .nav-link:hover {
            color: var(--black);
        }

        /* Hero Section */
        .hero {
            background-color: var(--black);
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(206, 255, 0, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(206, 255, 0, 0.06) 0%, transparent 50%);
            min-height: 45vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ceff00' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.4;
        }

        .hero-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 3rem 2rem;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .hero-logo-lockup {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0rem;
            margin-bottom: 3rem;
        }

        .hero-logo-lockup img {
            width: 260px;
            height: auto;
        }

        .hero-intro {
            font-size: 20px;
            line-height: 1.6;
            color: var(--light-gray);
            margin-bottom: 2.5rem;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-intro p {
            margin: 0 0 1.25rem 0;
        }

        .hero-intro p:last-child {
            margin-bottom: 0;
        }

        .hero-intro .expand-text {
            display: none;
        }

        .hero-intro.expanded .expand-text {
            display: block;
        }

        .read-more-btn {
            background: none;
            border: 2px solid var(--acid-green);
            color: var(--acid-green);
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.3s;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .read-more-btn:hover {
            background: var(--acid-green);
            color: var(--black);
            gap: 1rem;
        }

        .hero-links {
            display: flex;
            gap: 2.5rem;
            justify-content: center;
            margin-top: 3rem;
            flex-wrap: wrap;
        }

        .hero-link {
            color: var(--white);
            text-decoration: none;
            font-size: 17px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .hero-link:hover {
            color: var(--acid-green);
            border-bottom-color: var(--acid-green);
            gap: 0.75rem;
        }

        .hero-link::after {
            content: "\2192";
            font-size: 20px;
        }

        /* Database Introduction Section */
        .database-intro {
            max-width: 1400px;
            margin: 0 auto;
            padding: 3rem 2rem 1.5rem 2rem;
        }

        .database-intro-text {
            font-size: 14px;
            line-height: 1.6;
            color: var(--dark-gray);
            max-width: 700px;
            margin: 0 auto;
            text-align: center;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem 2rem 2rem;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
        }

        /* Sidebar Filters with Accordions */
        .sidebar {
            background-color: var(--white);
            padding: 1.5rem;
            border-radius: 12px;
            height: fit-content;
            position: sticky;
            top: 100px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            max-height: calc(100vh - 120px);
            overflow-y: auto;
        }

        .sidebar h2 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--black);
        }

        .filter-accordion {
            margin-bottom: 1rem;
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
        }

        .filter-accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.875rem 1rem;
            background-color: var(--light-gray);
            cursor: pointer;
            transition: background-color 0.2s;
            user-select: none;
        }

        .filter-accordion-header:hover {
            background-color: #e5e5e8;
        }

        .filter-accordion-header h3 {
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--dark-gray);
            margin: 0;
        }

        .filter-accordion-icon {
            font-size: 20px;
            color: var(--dark-gray);
            transition: transform 0.2s;
        }

        .filter-accordion.open .filter-accordion-icon {
            transform: rotate(180deg);
        }

        .filter-accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .filter-accordion.open .filter-accordion-content {
            max-height: 800px;
            transition: max-height 0.4s ease-in;
        }

        .filter-accordion-inner {
            padding: 1rem;
        }

        .filter-search {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: 'Hanken Grotesk', sans-serif;
            font-size: 13px;
            margin-bottom: 0.75rem;
        }

        .filter-search:focus {
            outline: none;
            border-color: var(--acid-green);
        }

        .filter-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0;
            cursor: pointer;
        }

        .filter-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--acid-green);
        }

        .filter-option label {
            font-size: 14px;
            cursor: pointer;
            flex: 1;
            line-height: 1.3;
        }

        .filter-count {
            font-size: 12px;
            color: #999;
            margin-left: auto;
        }

        .clear-filters {
            width: 100%;
            margin-top: 1.5rem;
            padding: 0.75rem;
            background-color: var(--light-gray);
            color: var(--dark-gray);
            border: none;
            border-radius: 8px;
            font-family: 'Hanken Grotesk', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .clear-filters:hover {
            background-color: #e5e5e8;
        }

        /* Clear Filters at Top - Prominent Style */
        .clear-filters-top {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--acid-green) 0%, var(--lime-green) 100%);
            color: var(--black);
            border: none;
            border-radius: 8px;
            font-family: 'Hanken Grotesk', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .clear-filters-top:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(206, 255, 0, 0.3);
        }

        .clear-filters-top .material-icons-outlined {
            font-size: 18px;
        }

        /* Advanced Filter Header */
        .advanced-filter-header {
            background-color: #f9f9f9;
            border-top: 2px solid #ddd;
            padding-top: 16px;
            margin-top: 8px;
        }

        .advanced-filter-header h3 {
            color: #666;
            font-size: 14px;
        }

        .filter-badge {
            background-color: #e0e0e0;
            color: #666;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: auto;
            margin-right: 8px;
        }

        /* Make Group filter prominent */
        #groupAccordion .filter-accordion-header h3 {
            font-size: 15px;
            font-weight: 700;
        }

        /* Main Content */
        .main-content {
            min-height: 600px;
        }

        .controls-bar {
            background-color: var(--white);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .results-count {
            font-size: 15px;
            font-weight: 600;
            color: var(--dark-gray);
        }

        .view-toggle {
            display: flex;
            gap: 0.5rem;
        }

        .view-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            background-color: var(--white);
            color: var(--dark-gray);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .view-btn.active {
            background-color: var(--black);
            color: var(--white);
            border-color: var(--black);
        }

        .view-btn:hover:not(.active) {
            background-color: var(--light-gray);
        }

        /* Grid View */
        .creators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .creator-card {
            background-color: var(--white);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.2s;
            cursor: pointer;
        }

        .creator-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .creator-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .creator-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--dark-gray);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            flex-shrink: 0;
        }

        .creator-info {
            flex: 1;
        }

        .creator-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 0.25rem;
            line-height: 1.2;
        }

        .creator-channel {
            font-size: 14px;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .creator-meta {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .creator-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 13px;
            color: var(--dark-gray);
        }

        .creator-meta-item.clickable-tag {
            cursor: pointer;
            transition: all 0.2s;
            padding: 0.25rem 0.5rem;
            margin: -0.25rem -0.5rem;
            border-radius: 4px;
        }

        .creator-meta-item.clickable-tag:hover {
            background-color: var(--acid-green);
            color: var(--black);
        }

        .creator-meta-item.clickable-tag:hover .creator-meta-icon {
            color: var(--black);
        }

        .creator-meta-icon {
            font-size: 16px;
            color: #999;
        }

        .creator-tag {
            display: inline-block;
            padding: 0.25rem 0.625rem;
            background-color: var(--light-gray);
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            color: var(--dark-gray);
        }

        .creator-tag.clickable-tag:hover {
            background-color: var(--acid-green);
            color: var(--black);
        }
        }

        /* List View */
        .creators-list {
            display: none;
            flex-direction: column;
            gap: 1rem;
        }

        .creators-list.active {
            display: flex;
        }

        .creator-list-item {
            background-color: var(--white);
            border-radius: 12px;
            padding: 1.25rem 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 1.5rem;
            align-items: center;
            transition: all 0.2s;
            cursor: pointer;
        }

        .creator-list-item:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #999;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .empty-state h3 {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark-gray);
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            font-size: 15px;
            color: #999;
        }

        /* Bubbles View */
        .bubbles-view {
            display: none;
            background-color: var(--white);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            min-height: 600px;
            position: relative;
        }

        .bubbles-view.active {
            display: block;
        }

        .bubble-mode-toggle {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .bubble-mode-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--dark-gray);
            background-color: transparent;
            color: var(--dark-gray);
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Hanken Grotesk', sans-serif;
        }

        .bubble-mode-btn.active {
            background-color: var(--acid-green);
            color: var(--black);
            border-color: var(--acid-green);
        }

        #bubbleChart {
            width: 100%;
            height: 600px;
        }

        .bubble {
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .bubble:hover {
            opacity: 0.8;
        }

        .bubble-label {
            font-family: 'Hanken Grotesk', sans-serif;
            font-size: 12px;
            font-weight: 600;
            fill: var(--black);
            pointer-events: none;
            text-anchor: middle;
        }

        .bubble-count {
            font-family: 'Hanken Grotesk', sans-serif;
            font-size: 18px;
            font-weight: 700;
            fill: var(--black);
            pointer-events: none;
            text-anchor: middle;
        }

        .bubble-tooltip {
            position: absolute;
            background-color: var(--black);
            color: var(--white);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-size: 14px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 1000;
            border: 2px solid var(--acid-green);
        }

        /* Sunburst/Wheel View */
        .sunburst-view {
            display: none;
            background-color: var(--white);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            min-height: 700px;
            position: relative;
        }

        .sunburst-view.active {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .sunburst-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 0.5rem;
            color: var(--black);
            letter-spacing: -0.5px;
        }

        .sunburst-subtitle {
            font-size: 15px;
            color: #666;
            margin-bottom: 2rem;
            font-weight: 500;
        }

        .sunburst-breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
            font-size: 14px;
            padding: 0.75rem 1.25rem;
            background: var(--light-gray);
            border-radius: 8px;
            width: fit-content;
        }

        .breadcrumb-item {
            color: #666;
            cursor: pointer;
            transition: all 0.2s;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            text-decoration: none;
        }

        .breadcrumb-item:hover {
            color: var(--black);
            background: rgba(206, 255, 0, 0.15);
            text-decoration: underline;
            transform: translateY(-1px);
        }

        .breadcrumb-item.active {
            color: var(--black);
            font-weight: 700;
            background: var(--acid-green);
            padding: 0.25rem 0.75rem;
            cursor: default;
        }

        .breadcrumb-item.active:hover {
            text-decoration: none;
            transform: none;
        }

        .breadcrumb-separator {
            color: #999;
        }

        #sunburstChart {
            width: 100%;
            max-width: 700px;
            height: 700px;
        }

        .sunburst-creators {
            display: none;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
            width: 100%;
            max-width: 900px;
        }

        .sunburst-creators.active {
            display: grid;
        }

        .sunburst-creator-card {
            background: var(--light-gray);
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .sunburst-creator-card:hover {
            border-color: var(--acid-green);
            transform: translateY(-2px);
        }

        .sunburst-creator-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--acid-green), var(--lime-green));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            color: var(--black);
            margin-bottom: 0.75rem;
        }

        .sunburst-creator-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 0.25rem;
        }

        .sunburst-creator-channel {
            font-size: 12px;
            color: #666;
        }

        .sunburst-arc {
            cursor: pointer;
            stroke: var(--white);
            stroke-width: 2.5;
            transition: all 0.2s ease;
        }

        .sunburst-arc:hover {
            stroke-width: 3;
            filter: brightness(1.1);
        }

        .sunburst-label {
            font-family: 'Hanken Grotesk', sans-serif;
            font-size: 12px;
            font-weight: 700;
            fill: var(--black);
            pointer-events: none;
            text-anchor: middle;
            paint-order: stroke;
            stroke: var(--white);
            stroke-width: 3px;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .sunburst-center-text {
            font-family: 'Hanken Grotesk', sans-serif;
            font-size: 18px;
            font-weight: 800;
            fill: var(--black);
            text-anchor: middle;
            transition: all 0.3s ease;
        }

        /* Center circle back indicator - shown when zoomed in */
        .sunburst-center-back {
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .sunburst-center-group:hover .sunburst-center-back {
            opacity: 1;
        }

        .sunburst-center-group {
            transition: all 0.2s ease;
        }

        .sunburst-center-group:hover circle {
            filter: brightness(0.95);
        }

        .sunburst-legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-top: 3rem;
            width: 100%;
            max-width: 900px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: var(--light-gray);
            border-radius: 8px;
            transition: all 0.2s;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .legend-item:hover {
            border-color: var(--acid-green);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: none;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .legend-item span {
            font-size: 13px;
            font-weight: 600;
            color: var(--dark-gray);
        }

        /* Treemap View Styles */
        .treemap-view {
            display: none;
            width: 100%;
            padding: 2rem;
            background-color: var(--white);
            border-radius: 12px;
        }

        .treemap-view.active {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .treemap-header {
            text-align: center;
        }

        .treemap-header h2 {
            font-size: 28px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 0.5rem;
        }

        .treemap-subtitle {
            font-size: 16px;
            color: #666;
        }

        #treemapChart {
            width: 100%;
            min-height: 600px;
            background-color: #fafafa;
            border-radius: 12px;
            overflow: hidden;
        }

        .treemap-cell {
            cursor: pointer;
        }

        .treemap-cell rect {
            transition: opacity 0.2s, stroke-width 0.2s;
        }

        .treemap-label {
            font-family: 'Hanken Grotesk', sans-serif;
            user-select: none;
            pointer-events: none;
        }

        .treemap-count {
            font-family: 'Hanken Grotesk', sans-serif;
            user-select: none;
            pointer-events: none;
        }

        .treemap-tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px 14px;
            border-radius: 6px;
            font-size: 13px;
            pointer-events: none;
            z-index: 10000;
            display: none;
            max-width: 250px;
            line-height: 1.4;
        }

        /* Loading State */
        .loading-state {
            text-align: center;
            padding: 4rem 2rem;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--light-gray);
            border-top-color: var(--acid-green);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: static;
                max-height: none;
            }
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .hero-logo-text h1 {
                font-size: 32px;
            }

            .hero-intro {
                font-size: 18px;
            }

            .creators-grid {
                grid-template-columns: 1fr;
            }
        }
    

/* Mobile Menu Button */
.mobile-menu-button {
    display: none;
    background: none;
    border: none;
    color: var(--dark-gray);
    font-size: 24px;
    cursor: pointer;
    padding: 0.5rem;
}

/* Mobile Menu Overlay */
.mobile-menu-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 999;
}

.mobile-menu-overlay.active {
    display: block;
}

/* Mobile Menu Drawer */
.mobile-menu {
    display: none;
    position: fixed;
    top: 0;
    right: -300px;
    width: 280px;
    height: 100%;
    background-color: var(--white);
    box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    transition: right 0.3s ease;
    overflow-y: auto;
}

.mobile-menu.active {
    right: 0;
}

.mobile-menu-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--medium-gray);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.mobile-menu-close {
    background: none;
    border: none;
    font-size: 28px;
    color: var(--dark-gray);
    cursor: pointer;
    padding: 0;
}

.mobile-menu-links {
    padding: 1rem 0;
}

.mobile-menu-link {
    display: block;
    padding: 1rem 1.5rem;
    color: var(--black);
    text-decoration: none;
    font-size: 16px;
    font-weight: 500;
    border-left: 3px solid transparent;
    transition: all 0.2s;
}

.mobile-menu-link:hover,
.mobile-menu-link:active {
    background-color: var(--light-gray);
    border-left-color: var(--acid-green);
}

@media (max-width: 768px) {
    .mobile-menu-button {
        display: block;
    }
    
    .mobile-menu {
        display: block;
    }
}

    </style>
</head>
<body>
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-logo-search">
                <a href="#" class="nav-logo">
                    <img src="Journalism_Atlas_wordmark_lockup_black.png" alt="Independent Journalism Atlas">
                </a>
                <div class="nav-search-container">
                    <input 
                        type="text" 
                        class="nav-search" 
                        placeholder="Search creators, topics, places..."
                        id="navSearch"
                    />
                </div>
            </div>
            <div class="nav-links">
                <a href="#who-we-are" class="nav-link">Who We Are</a>
                <a href="#what-we-do" class="nav-link">What We Do</a>
                <a href="#advisory" class="nav-link">Advisory Boards</a>
                <a href="#contact" class="nav-link">Contact</a>
                <a href="#research" class="nav-link">Our Research</a>
            </div>
            <button class="mobile-menu-button" id="mobileMenuButton" aria-label="Open menu">
                √¢Àú¬∞
            </button>
        </div>
    
    
    <!-- Mobile Menu -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-header">
            <strong>Menu</strong>
            <button class="mobile-menu-close" id="mobileMenuClose" aria-label="Close menu">√É‚Äî</button>
        </div>
        <nav class="mobile-menu-links">
            <a href="/who-we-are.html" class="mobile-menu-link">Who We Are</a>
            <a href="/what-we-do.html" class="mobile-menu-link">What We Do</a>
            <a href="/advisory.html" class="mobile-menu-link">Advisory Boards</a>
            <a href="/contact.html" class="mobile-menu-link">Contact</a>
            <a href="/research.html" class="mobile-menu-link">Our Research</a>
        </nav>
    </div>

    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <div class="hero-logo-lockup">
                <img src="Journalism_Atlas_wordmark_stacked_green_white.png" alt="Independent Journalism Atlas">
            </div>
            
            <div class="hero-intro" id="heroIntro">
                <p>Who's covering what, where, and how? This database tracks independent journalists and creator-journalists across platforms and topics. Think of the Atlas as your reference guide&mdash;like IMDb for journalism.</p>
                <div class="expand-text">
                    <p>Traditional newsrooms are evolving. Independent voices are building new models for storytelling, investigation, and community engagement. From Substack newsletters to YouTube channels to TikTok reporting, creator journalism represents a fundamental shift in how news gets made and delivered.</p>
                    <p>This atlas maps that ecosystem&mdash;helping funders find creators to support, helping journalists discover peers and models, and helping audiences understand the landscape of independent news.</p>
                </div>
            </div>
            
            <button class="read-more-btn" id="readMoreBtn">
                <span id="readMoreText">Learn More About Creator Journalism</span>
                <span>&#8595;</span>
            </button>

            <div class="hero-links">
                <a href="#about" class="hero-link">About this project</a>
                <a href="#mission" class="hero-link">View our mission statement</a>
            </div>
        </div>
    </section>

    <!-- Database Introduction -->
    <section class="database-intro">
        <div class="database-intro-text">
            Browse <strong id="totalCreatorsCount">471</strong> independent journalists by platform, topic, or location. Use the filters to narrow your search.
        </div>
    </section>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar Filters -->
        <aside class="sidebar">
            <h2>Filters</h2>
            
            <!-- Clear Filters at TOP -->
            <button class="clear-filters-top" onclick="clearAllFilters()">
                <span class="material-icons-outlined">close</span>
                Clear All Filters
            </button>

            <!-- Group Filter Accordion (PRIMARY) -->
            <div class="filter-accordion open" id="groupAccordion">
                <div class="filter-accordion-header" onclick="toggleAccordion('groupAccordion')">
                    <h3>üéØ Group</h3>
                    <span class="filter-accordion-icon material-icons-outlined">expand_more</span>
                </div>
                <div class="filter-accordion-content">
                    <div class="filter-accordion-inner">
                        <div id="groupFilters">
                            <!-- Group checkboxes will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Platform Filter Accordion -->
            <div class="filter-accordion open" id="platformAccordion">
                <div class="filter-accordion-header" onclick="toggleAccordion('platformAccordion')">
                    <h3>üì∫ Primary Platform</h3>
                    <span class="filter-accordion-icon material-icons-outlined">expand_more</span>
                </div>
                <div class="filter-accordion-content">
                    <div class="filter-accordion-inner">
                        <input 
                            type="text" 
                            class="filter-search" 
                            placeholder="Search platforms..."
                            id="platformSearch"
                            onkeyup="filterOptions('platformSearch', 'platformFilters')"
                        />
                        <div id="platformFilters">
                            <!-- Platform checkboxes will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Geography Filter Accordion -->
            <div class="filter-accordion" id="geographyAccordion">
                <div class="filter-accordion-header" onclick="toggleAccordion('geographyAccordion')">
                    <h3>üåç Geography</h3>
                    <span class="filter-accordion-icon material-icons-outlined">expand_more</span>
                </div>
                <div class="filter-accordion-content">
                    <div class="filter-accordion-inner">
                        <input 
                            type="text" 
                            class="filter-search" 
                            placeholder="Search locations..."
                            id="geographySearch"
                            onkeyup="filterOptions('geographySearch', 'geographyFilters')"
                        />
                        <div id="geographyFilters">
                            <!-- Geography checkboxes will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Topic Filter Accordion (ADVANCED - Collapsed by default) -->
            <div class="filter-accordion" id="topicAccordion">
                <div class="filter-accordion-header advanced-filter-header" onclick="toggleAccordion('topicAccordion')">
                    <h3>üîç Advanced: Topic / Category</h3>
                    <span class="filter-badge">70+ topics</span>
                    <span class="filter-accordion-icon material-icons-outlined">expand_more</span>
                </div>
                <div class="filter-accordion-content">
                    <div class="filter-accordion-inner">
                        <input 
                            type="text" 
                            class="filter-search" 
                            placeholder="Search topics..."
                            id="topicSearch"
                            onkeyup="filterOptions('topicSearch', 'topicFilters')"
                        />
                        <div id="topicFilters">
                            <!-- Topic checkboxes will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <button class="clear-filters" onclick="clearAllFilters()">Clear All Filters</button>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Controls Bar -->
            <div class="controls-bar">
                <div class="results-count" id="resultsCount">
                    Showing <strong>0</strong> of <strong>471</strong> creators
                </div>
                <div class="view-toggle">
                    <button class="view-btn active" onclick="toggleView('grid')">Grid</button>
                    <button class="view-btn" onclick="toggleView('list')">List</button>
                    <button class="view-btn" onclick="toggleView('bubbles')">Bubbles</button>
                    <button class="view-btn" onclick="toggleView('wheel')">Wheel</button>
                    <button class="view-btn" onclick="toggleView('treemap')">Treemap</button>
                </div>
            </div>

            <!-- Loading State -->
            <div class="loading-state" id="loadingState">
                <div class="loading-spinner"></div>
                <p>Loading creators...</p>
            </div>

            <!-- Grid View -->
            <div class="creators-grid" id="creatorsGrid">
                <!-- Creator cards will be populated by JavaScript -->
            </div>

            <!-- List View -->
            <div class="creators-list" id="creatorsList">
                <!-- Creator list items will be populated by JavaScript -->
            </div>

            <!-- Bubbles View -->
            <div class="bubbles-view" id="bubblesView">
                <div class="bubble-mode-toggle">
                    <button class="bubble-mode-btn" onclick="setBubbleMode('geography')">By Geography</button>
                    <button class="bubble-mode-btn active" onclick="setBubbleMode('platform')">By Platform</button>
                    <button class="bubble-mode-btn" onclick="setBubbleMode('topic')">By Topic</button>
                    <button class="bubble-mode-btn" onclick="setBubbleMode('group')">By Group</button>
                </div>
                <svg id="bubbleChart"></svg>
                <div class="bubble-tooltip" id="bubbleTooltip"></div>
            </div>

            <!-- Sunburst/Wheel View -->
            <div class="sunburst-view" id="sunburstView">
                <h2 class="sunburst-title">Discovery Wheel</h2>
                <p class="sunburst-subtitle">Platforms (inner) ‚Üí Groups (outer) &bull; Click to explore</p>
                
                <!-- Breadcrumb navigation -->
                <div class="sunburst-breadcrumb" id="sunburstBreadcrumb">
                    <span class="breadcrumb-item active" title="You are viewing all creators">√∞≈∏¬è¬† All Creators</span>
                </div>
                
                <svg id="sunburstChart"></svg>
                
                <!-- Creators grid (shown when topic is selected) -->
                <div class="sunburst-creators" id="sunburstCreators"></div>
                
                <div class="sunburst-legend" id="sunburstLegend"></div>
                <div class="bubble-tooltip" id="sunburstTooltip"></div>
            </div>

            <!-- Treemap View -->
            <div class="treemap-view" id="treemapView">
                <div class="treemap-header">
                    <h2>Topics by Group</h2>
                    <p class="treemap-subtitle">Size represents number of creators &bull; Click to explore</p>
                </div>
                <div id="treemapChart"></div>
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <div class="empty-state-icon material-icons-outlined">search_off</div>
                <h3>No creators found</h3>
                <p>Try adjusting your filters or search terms</p>
            </div>
        </main>
    </div>

    <script>
        // Global state
        let allCreators = [];
        let filteredCreators = [];
        let activeFilters = {
            group: new Set(),
            platform: new Set(),
            geography: new Set(),
            topic: new Set(),
            search: ''
        };
        let currentView = 'grid';
        let currentBubbleMode = 'platform';

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadCreatorsData();
            setupScrollBehavior();
            setupReadMore();
            loadFiltersFromURL();
        });

        // Load and parse CSV data
        async function loadCreatorsData() {
            try {
                const response = await fetch('creators-data.json');
                const data = await response.json();
                
                allCreators = data;
                
                // Update total count in the intro text
                document.getElementById('totalCreatorsCount').textContent = allCreators.length;
                
                // Build filter options
                buildFilterOptions();
                
                // Initial render
                applyFilters();
                
                // Hide loading state
                document.getElementById('loadingState').style.display = 'none';
                
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loadingState').innerHTML = '<p style="color: red;">Error loading data. Please refresh the page.</p>';
            }
        }

        // Build filter options from data
        function buildFilterOptions() {
            const groups = new Map();
            const platforms = new Map();
            const geographies = new Map();
            const topics = new Map();
            
            allCreators.forEach(creator => {
                // Group (NEW!)
                if (creator.group) {
                    groups.set(creator.group, (groups.get(creator.group) || 0) + 1);
                }
                
                // Platform
                if (creator.platform) {
                    platforms.set(creator.platform, (platforms.get(creator.platform) || 0) + 1);
                }
                
                // Geography
                if (creator.geography) {
                    geographies.set(creator.geography, (geographies.get(creator.geography) || 0) + 1);
                }
                
                // Topic
                if (creator.topic) {
                    topics.set(creator.topic, (topics.get(creator.topic) || 0) + 1);
                }
            });
            
            // Populate group filters (FIRST - primary filter!)
            const groupFilters = document.getElementById('groupFilters');
            // Order groups as Ryan specified
            const orderedGroups = [
                'Power & Politics',
                'Money & Work',
                'Civic Life',
                'Social Issues',
                'Science, Health & Environment',
                'Culture & Media',
                'Lifestyle & Personal Life',
                'Journalism Formats',
                'General News'
            ];
            orderedGroups.forEach(groupName => {
                const count = groups.get(groupName);
                if (count) {
                    groupFilters.appendChild(createFilterOption('group', groupName, count));
                }
            });
            // Add any groups not in the ordered list
            Array.from(groups.entries())
                .filter(([group]) => !orderedGroups.includes(group))
                .sort((a, b) => a[0].localeCompare(b[0]))
                .forEach(([group, count]) => {
                    groupFilters.appendChild(createFilterOption('group', group, count));
                });
            
            // Populate platform filters
            const platformFilters = document.getElementById('platformFilters');
            Array.from(platforms.entries())
                .sort((a, b) => b[1] - a[1]) // Sort by count descending
                .forEach(([platform, count]) => {
                    platformFilters.appendChild(createFilterOption('platform', platform, count));
                });
            
            // Populate geography filters
            const geographyFilters = document.getElementById('geographyFilters');
            Array.from(geographies.entries())
                .sort((a, b) => a[0].localeCompare(b[0])) // Sort alphabetically
                .forEach(([geography, count]) => {
                    geographyFilters.appendChild(createFilterOption('geography', geography, count));
                });
            
            // Populate topic filters
            const topicFilters = document.getElementById('topicFilters');
            Array.from(topics.entries())
                .sort((a, b) => a[0].localeCompare(b[0])) // Sort alphabetically
                .forEach(([topic, count]) => {
                    topicFilters.appendChild(createFilterOption('topic', topic, count));
                });
        }

        // Create filter option element
        function createFilterOption(type, value, count) {
            const div = document.createElement('div');
            div.className = 'filter-option';
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = `${type}-${value.replace(/\s+/g, '-')}`;
            checkbox.value = value;
            checkbox.onchange = () => toggleFilter(type, value);
            
            const label = document.createElement('label');
            label.htmlFor = checkbox.id;
            label.textContent = value;
            
            const countSpan = document.createElement('span');
            countSpan.className = 'filter-count';
            countSpan.textContent = `(${count})`;
            
            div.appendChild(checkbox);
            div.appendChild(label);
            div.appendChild(countSpan);
            
            return div;
        }

        // Toggle filter selection
        function toggleFilter(type, value) {
            if (activeFilters[type].has(value)) {
                activeFilters[type].delete(value);
            } else {
                activeFilters[type].add(value);
            }
            applyFilters();
            updateURL();
        }

        // Apply all active filters
        function applyFilters() {
            filteredCreators = allCreators.filter(creator => {
                // Group filter (NEW - check first!)
                if (activeFilters.group.size > 0 && !activeFilters.group.has(creator.group)) {
                    return false;
                }
                
                // Platform filter
                if (activeFilters.platform.size > 0 && !activeFilters.platform.has(creator.platform)) {
                    return false;
                }
                
                // Geography filter
                if (activeFilters.geography.size > 0 && !activeFilters.geography.has(creator.geography)) {
                    return false;
                }
                
                // Topic filter
                if (activeFilters.topic.size > 0 && !activeFilters.topic.has(creator.topic)) {
                    return false;
                }
                
                // Search filter
                if (activeFilters.search) {
                    const searchLower = activeFilters.search.toLowerCase();
                    return (
                        creator.name.toLowerCase().includes(searchLower) ||
                        creator.channel.toLowerCase().includes(searchLower) ||
                        (creator.topic && creator.topic.toLowerCase().includes(searchLower)) ||
                        (creator.geography && creator.geography.toLowerCase().includes(searchLower)) ||
                        (creator.group && creator.group.toLowerCase().includes(searchLower))
                    );
                }
                
                return true;
            });
            
            renderCreators();
            updateResultsCount();
        }

        // Render creators in current view
        function renderCreators() {
            if (filteredCreators.length === 0) {
                document.getElementById('creatorsGrid').style.display = 'none';
                document.getElementById('creatorsList').style.display = 'none';
                document.getElementById('emptyState').style.display = 'block';
                return;
            }
            
            document.getElementById('emptyState').style.display = 'none';
            
            if (currentView === 'grid') {
                renderGridView();
            } else {
                renderListView();
            }
        }

        // Render grid view
        function renderGridView() {
            const grid = document.getElementById('creatorsGrid');
            grid.innerHTML = '';
            // Remove inline style to let CSS handle it properly
            grid.style.display = '';
            
            filteredCreators.forEach(creator => {
                const card = createCreatorCard(creator);
                grid.appendChild(card);
            });
        }

        // Render list view
        function renderListView() {
            const list = document.getElementById('creatorsList');
            list.innerHTML = '';
            list.classList.add('active');
            
            filteredCreators.forEach(creator => {
                const item = createCreatorListItem(creator);
                list.appendChild(item);
            });
        }

        // Create creator card for grid view
        function createCreatorCard(creator) {
            const card = document.createElement('div');
            card.className = 'creator-card';
            card.onclick = () => window.open(creator.link, '_blank');
            
            const initials = creator.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
            
            card.innerHTML = `
                <div class="creator-header">
                    <div class="creator-avatar">${initials}</div>
                    <div class="creator-info">
                        <div class="creator-name">${creator.name}</div>
                        <div class="creator-channel">${creator.channel}</div>
                    </div>
                </div>
                <div class="creator-meta">
                    ${creator.geography ? `
                        <div class="creator-meta-item clickable-tag" data-filter-type="geography" data-filter-value="${creator.geography}">
                            <span class="material-icons-outlined creator-meta-icon">location_on</span>
                            <span>${creator.geography}</span>
                        </div>
                    ` : ''}
                    ${creator.platform ? `
                        <div class="creator-meta-item clickable-tag" data-filter-type="platform" data-filter-value="${creator.platform}">
                            <span class="material-icons-outlined creator-meta-icon">devices</span>
                            <span>${creator.platform}</span>
                        </div>
                    ` : ''}
                    ${creator.topic ? `
                        <div class="creator-meta-item clickable-tag" data-filter-type="topic" data-filter-value="${creator.topic}">
                            <span class="material-icons-outlined creator-meta-icon">tag</span>
                            <span class="creator-tag">${creator.topic}</span>
                        </div>
                    ` : ''}
                </div>
            `;
            
            // Add click handlers to tags
            card.querySelectorAll('.clickable-tag').forEach(tag => {
                tag.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const filterType = tag.dataset.filterType;
                    const filterValue = tag.dataset.filterValue;
                    handleTagClick(e, filterType, filterValue);
                });
            });
            
            return card;
        }

        // Create creator list item for list view
        function createCreatorListItem(creator) {
            const item = document.createElement('div');
            item.className = 'creator-list-item';
            item.onclick = () => window.open(creator.link, '_blank');
            
            const initials = creator.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
            
            item.innerHTML = `
                <div class="creator-avatar">${initials}</div>
                <div>
                    <div class="creator-name">${creator.name}</div>
                    <div class="creator-channel">${creator.channel}</div>
                    <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                        ${creator.geography ? `<span class="clickable-tag" data-filter-type="geography" data-filter-value="${creator.geography}" style="font-size: 13px; color: #666; display: flex; align-items: center; gap: 0.25rem; cursor: pointer;"><span class="material-icons-outlined" style="font-size: 16px;">location_on</span>${creator.geography}</span>` : ""}
                        ${creator.platform ? `<span class="clickable-tag" data-filter-type="platform" data-filter-value="${creator.platform}" style="font-size: 13px; color: #666; display: flex; align-items: center; gap: 0.25rem; cursor: pointer;"><span class="material-icons-outlined" style="font-size: 16px;">devices</span>${creator.platform}</span>` : ""}
                        ${creator.topic ? `<span class="creator-tag clickable-tag" data-filter-type="topic" data-filter-value="${creator.topic}" style="cursor: pointer;">${creator.topic}</span>` : ''}
                    </div>
                </div>
                <span class="material-icons-outlined" style="color: #999;">arrow_forward</span>
            `;
            
            // Add click handlers to tags
            item.querySelectorAll('.clickable-tag').forEach(tag => {
                tag.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const filterType = tag.dataset.filterType;
                    const filterValue = tag.dataset.filterValue;
                    handleTagClick(e, filterType, filterValue);
                });
            });
            
            return item;
        }

        // Update results count
        function updateResultsCount() {
            const count = filteredCreators.length;
            const total = allCreators.length;
            document.getElementById('resultsCount').innerHTML = `
                Showing <strong>${count}</strong> of <strong>${total}</strong> creators
            `;
        }

        // Handle tag clicks to apply filters
        function handleTagClick(event, filterType, filterValue) {
            event.stopPropagation(); // Prevent card click
            
            // Add the filter
            activeFilters[filterType].add(filterValue);
            
            // Update the corresponding checkbox in the sidebar
            const checkboxes = document.querySelectorAll(`#${filterType}Filters input[type="checkbox"]`);
            checkboxes.forEach(checkbox => {
                if (checkbox.value === filterValue) {
                    checkbox.checked = true;
                }
            });
            
            applyFilters();
        }

        // Toggle accordion
        function toggleAccordion(accordionId) {
            const accordion = document.getElementById(accordionId);
            accordion.classList.toggle('open');
        }

        // Filter options within accordion
        function filterOptions(searchId, containerId) {
            const searchInput = document.getElementById(searchId);
            const searchTerm = searchInput.value.toLowerCase();
            const container = document.getElementById(containerId);
            const options = container.getElementsByClassName('filter-option');
            
            Array.from(options).forEach(option => {
                const label = option.querySelector('label').textContent.toLowerCase();
                option.style.display = label.includes(searchTerm) ? 'flex' : 'none';
            });
        }

        // Clear all filters
        function clearAllFilters() {
            activeFilters.platform.clear();
            activeFilters.geography.clear();
            activeFilters.topic.clear();
            activeFilters.search = '';
            
            // Uncheck all checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            // Clear search inputs
            document.getElementById('navSearch').value = '';
            
            applyFilters();
            updateURL();
        }

        // Toggle view
        function toggleView(view) {
            currentView = view;
            
            // Update button states
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
                // Add active to the button that matches this view
                if (btn.textContent.toLowerCase() === view || 
                    (view === 'wheel' && btn.textContent.toLowerCase() === 'wheel')) {
                    btn.classList.add('active');
                }
            });
            
            // Hide all views first - use classes instead of inline styles
            const grid = document.getElementById('creatorsGrid');
            const list = document.getElementById('creatorsList');
            const bubbles = document.getElementById('bubblesView');
            const sunburst = document.getElementById('sunburstView');
            const treemap = document.getElementById('treemapView');
            const empty = document.getElementById('emptyState');
            
            // Reset all views
            grid.style.display = 'none';
            grid.classList.remove('active');
            list.style.display = ''; // Remove inline style to let CSS handle it
            list.classList.remove('active');
            bubbles.classList.remove('active');
            sunburst.classList.remove('active');
            treemap.classList.remove('active');
            empty.style.display = 'none';
            
            // Show selected view
            if (view === 'grid') {
                if (filteredCreators.length === 0) {
                    empty.style.display = 'block';
                } else {
                    grid.style.display = 'grid';
                    grid.classList.add('active');
                    renderGridView();
                }
            } else if (view === 'list') {
                if (filteredCreators.length === 0) {
                    empty.style.display = 'block';
                } else {
                    // Don't set inline display - let CSS class handle it
                    list.classList.add('active');
                    renderListView();
                }
            } else if (view === 'bubbles') {
                bubbles.classList.add('active');
                renderBubbleChart();
            } else if (view === 'wheel') {
                sunburst.classList.add('active');
                renderSunburstChart();
            } else if (view === 'treemap') {
                treemap.classList.add('active');
                renderTreemapChart();
            }
        }

        // Nav search functionality
        document.getElementById('navSearch').addEventListener('input', function(e) {
            activeFilters.search = e.target.value;
            applyFilters();
            updateURL();
        });

        // URL parameter handling for permalinks
        function updateURL() {
            const params = new URLSearchParams();
            
            if (activeFilters.platform.size > 0) {
                params.set('platform', Array.from(activeFilters.platform).join(','));
            }
            if (activeFilters.geography.size > 0) {
                params.set('geography', Array.from(activeFilters.geography).join(','));
            }
            if (activeFilters.topic.size > 0) {
                params.set('topic', Array.from(activeFilters.topic).join(','));
            }
            if (activeFilters.search) {
                params.set('search', activeFilters.search);
            }
            
            const newURL = params.toString() ? `?${params.toString()}` : window.location.pathname;
            window.history.replaceState({}, '', newURL);
        }

        function loadFiltersFromURL() {
            const params = new URLSearchParams(window.location.search);
            
            // Load platform filters
            if (params.has('platform')) {
                params.get('platform').split(',').forEach(value => {
                    activeFilters.platform.add(value);
                    const checkbox = document.querySelector(`input[value="${value}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            
            // Load geography filters
            if (params.has('geography')) {
                params.get('geography').split(',').forEach(value => {
                    activeFilters.geography.add(value);
                    const checkbox = document.querySelector(`input[value="${value}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            
            // Load topic filters
            if (params.has('topic')) {
                params.get('topic').split(',').forEach(value => {
                    activeFilters.topic.add(value);
                    const checkbox = document.querySelector(`input[value="${value}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            
            // Load search
            if (params.has('search')) {
                activeFilters.search = params.get('search');
                document.getElementById('navSearch').value = params.get('search');
            }
        }

        // Scroll behavior
        function setupScrollBehavior() {
            let lastScroll = 0;
            const nav = document.querySelector('.top-nav');
            
            window.addEventListener('scroll', () => {
                const currentScroll = window.pageYOffset;
                
                if (currentScroll > 100) {
                    nav.classList.add('scrolled');
                } else {
                    nav.classList.remove('scrolled');
                }
                
                lastScroll = currentScroll;
            });
        }

        // Read more button
        function setupReadMore() {
            const btn = document.getElementById('readMoreBtn');
            const intro = document.getElementById('heroIntro');
            const text = document.getElementById('readMoreText');
            
            btn.addEventListener('click', () => {
                intro.classList.toggle('expanded');
                if (intro.classList.contains('expanded')) {
                    text.textContent = 'Show Less';
                } else {
                    text.textContent = 'Learn More About Creator Journalism';
                }
            });
        }

        // Bubble visualization functions
        function setBubbleMode(mode) {
            currentBubbleMode = mode;
            document.querySelectorAll('.bubble-mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderBubbleChart();
        }

        function renderBubbleChart() {
            const svg = d3.select('#bubbleChart');
            const container = document.getElementById('bubblesView');
            const width = container.clientWidth - 40;
            const height = 600;

            svg.attr('width', width).attr('height', height);
            svg.selectAll('*').remove();

            // Prepare data based on mode
            let bubbleData = [];
            
            if (currentBubbleMode === 'geography') {
                const geoCounts = {};
                filteredCreators.forEach(c => {
                    if (c.geography) {
                        geoCounts[c.geography] = (geoCounts[c.geography] || 0) + 1;
                    }
                });
                bubbleData = Object.entries(geoCounts).map(([name, count]) => ({
                    name,
                    count,
                    type: 'geography'
                }));
            } else if (currentBubbleMode === 'platform') {
                const platformCounts = {};
                filteredCreators.forEach(c => {
                    if (c.platform) {
                        platformCounts[c.platform] = (platformCounts[c.platform] || 0) + 1;
                    }
                });
                bubbleData = Object.entries(platformCounts).map(([name, count]) => ({
                    name,
                    count,
                    type: 'platform'
                }));
            } else if (currentBubbleMode === 'topic') {
                const topicCounts = {};
                filteredCreators.forEach(c => {
                    if (c.topic) {
                        topicCounts[c.topic] = (topicCounts[c.topic] || 0) + 1;
                    }
                });
                bubbleData = Object.entries(topicCounts).map(([name, count]) => ({
                    name,
                    count,
                    type: 'topic'
                }));
            } else if (currentBubbleMode === 'group') {
                const groupCounts = {};
                filteredCreators.forEach(c => {
                    if (c.group) {
                        groupCounts[c.group] = (groupCounts[c.group] || 0) + 1;
                    }
                });
                bubbleData = Object.entries(groupCounts).map(([name, count]) => ({
                    name,
                    count,
                    type: 'group'
                }));
            }

            if (bubbleData.length === 0) {
                svg.append('text')
                    .attr('x', width / 2)
                    .attr('y', height / 2)
                    .attr('text-anchor', 'middle')
                    .style('font-size', '18px')
                    .style('fill', '#999')
                    .text('No data to display');
                return;
            }

            // Sort by count descending for better layout
            bubbleData.sort((a, b) => b.count - a.count);

            // Create scale for bubble size
            const maxCount = d3.max(bubbleData, d => d.count);
            const totalBubbles = bubbleData.length;

            // Dynamically adjust radius range based on number of bubbles
            const minRadius = totalBubbles > 30 ? 15 : 20;
            const maxRadius = totalBubbles > 30 ? 70 : 100;

            const radiusScale = d3.scaleSqrt()
                .domain([1, maxCount])
                .range([minRadius, maxRadius]);

            // Add radius to data
            bubbleData.forEach(d => {
                d.radius = radiusScale(d.count);
                d.x = Math.random() * width;
                d.y = Math.random() * height;
            });

            // Create color scale
            const colorScale = d3.scaleLinear()
                .domain([0, maxCount / 2, maxCount])
                .range(['#97d600', '#ceff00', '#e8ff6b']);

            // Create zoomable container
            const g = svg.append('g').attr('class', 'bubble-container');

            // Add zoom behavior
            const zoom = d3.zoom()
                .scaleExtent([0.5, 4])
                .on('zoom', (event) => {
                    g.attr('transform', event.transform);
                });

            svg.call(zoom);

            // Add zoom controls hint
            svg.append('text')
                .attr('x', 10)
                .attr('y', height - 10)
                .attr('class', 'zoom-hint')
                .style('font-size', '12px')
                .style('fill', '#999')
                .text('Scroll to zoom &bull; Drag to pan &bull; Click bubble to filter');

            // Create force simulation
            const collisionStrength = totalBubbles > 30 ? 3 : 4;
            const simulation = d3.forceSimulation(bubbleData)
                .force('charge', d3.forceManyBody().strength(10))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide(d => d.radius + collisionStrength))
                .force('x', d3.forceX(width / 2).strength(0.07))
                .force('y', d3.forceY(height / 2).strength(0.07));

            // Create bubble groups
            const bubbles = g.selectAll('.bubble-group')
                .data(bubbleData)
                .enter()
                .append('g')
                .attr('class', 'bubble-group')
                .style('cursor', 'pointer');

            // Add circles
            bubbles.append('circle')
                .attr('class', 'bubble')
                .attr('r', d => d.radius)
                .attr('fill', d => colorScale(d.count))
                .attr('stroke', '#000000')
                .attr('stroke-width', 2)
                .on('click', function(event, d) {
                    event.stopPropagation();
                    handleBubbleClick(d);
                })
                .on('mouseover', function(event, d) {
                    d3.select(this).attr('opacity', 0.8).attr('stroke-width', 3);
                    showBubbleTooltip(event, d);
                })
                .on('mouseout', function(event, d) {
                    d3.select(this).attr('opacity', 1).attr('stroke-width', 2);
                    hideBubbleTooltip();
                });

            // Only show count on bubbles with radius > threshold
            const labelThreshold = totalBubbles > 30 ? 25 : 20;

            bubbles.filter(d => d.radius >= labelThreshold)
                .append('text')
                .attr('class', 'bubble-count')
                .attr('dy', d => d.radius >= 40 ? '-0.3em' : '0.35em')
                .text(d => d.count);

            // Only show label text on larger bubbles
            bubbles.filter(d => d.radius >= 40)
                .append('text')
                .attr('class', 'bubble-label')
                .attr('dy', '1.2em')
                .text(d => {
                    const maxLen = d.radius > 60 ? 15 : 10;
                    if (d.name.length > maxLen) return d.name.substring(0, maxLen) + '...';
                    return d.name;
                });

            // Update positions on tick
            simulation.on('tick', () => {
                bubbles.attr('transform', d => `translate(${d.x},${d.y})`);
            });

            // Add legend showing top categories
            const legendData = bubbleData.slice(0, Math.min(5, bubbleData.length));
            const legend = svg.append('g')
                .attr('class', 'bubble-legend')
                .attr('transform', `translate(${width - 150}, 20)`);

            legend.append('text')
                .attr('class', 'legend-title')
                .style('font-size', '12px')
                .style('font-weight', '600')
                .text('Top Categories');

            legendData.forEach((d, i) => {
                const legendItem = legend.append('g')
                    .attr('transform', `translate(0, ${20 + i * 18})`);

                legendItem.append('circle')
                    .attr('r', 6)
                    .attr('fill', colorScale(d.count));

                legendItem.append('text')
                    .attr('x', 12)
                    .attr('y', 4)
                    .style('font-size', '11px')
                    .text(`${d.name.substring(0, 12)}${d.name.length > 12 ? '...' : ''} (${d.count})`);
            });
        }

        function handleBubbleClick(bubble) {
            // Clear all filters first
            activeFilters.platform.clear();
            activeFilters.geography.clear();
            activeFilters.topic.clear();
            activeFilters.search = '';
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);

            // Apply filter based on bubble type
            if (bubble.type === 'geography') {
                activeFilters.geography.add(bubble.name);
                const checkbox = document.querySelector(`input[value="${bubble.name}"]`);
                if (checkbox) checkbox.checked = true;
            } else if (bubble.type === 'platform') {
                activeFilters.platform.add(bubble.name);
                const checkbox = document.querySelector(`input[value="${bubble.name}"]`);
                if (checkbox) checkbox.checked = true;
            } else if (bubble.type === 'topic') {
                activeFilters.topic.add(bubble.name);
                const checkbox = document.querySelector(`input[value="${bubble.name}"]`);
                if (checkbox) checkbox.checked = true;
            }

            // Apply filters and switch to grid view
            applyFilters();
            updateURL();
            
            // Switch to grid view to show filtered results
            currentView = 'grid';
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.view-btn:first-child').classList.add('active');
            document.getElementById('bubblesView').classList.remove('active');
            document.getElementById('creatorsGrid').style.display = 'grid';
            renderGridView();
        }

        function showBubbleTooltip(event, d) {
            const tooltip = document.getElementById('bubbleTooltip');
            tooltip.innerHTML = `
                <strong>${d.name}</strong><br>
                ${d.count} creator${d.count !== 1 ? 's' : ''}
            `;
            tooltip.style.left = (event.pageX + 10) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';
            tooltip.style.opacity = 1;
        }

        function hideBubbleTooltip() {
            document.getElementById('bubbleTooltip').style.opacity = 0;
        }

        // Sunburst/Wheel visualization functions
        function renderSunburstChart() {
            const svg = d3.select('#sunburstChart');
            const width = 700;
            const height = 700;
            const radius = Math.min(width, height) / 2;

            svg.attr('width', width).attr('height', height);
            svg.selectAll('*').remove();

            const g = svg.append('g')
                .attr('transform', `translate(${width / 2},${height / 2})`);

            // Build hierarchical data structure: Platform ‚Üí Group
            const platformData = {};
            
            filteredCreators.forEach(creator => {
                const platform = creator.platform || 'Unknown';
                const group = creator.group || 'Uncategorized';
                
                if (!platformData[platform]) {
                    platformData[platform] = {};
                }
                if (!platformData[platform][group]) {
                    platformData[platform][group] = 0;
                }
                platformData[platform][group]++;
            });

            // Convert to hierarchy
            const hierarchyData = {
                name: 'All Creators',
                children: Object.entries(platformData).map(([platform, groups]) => ({
                    name: platform,
                    children: Object.entries(groups).map(([group, count]) => ({
                        name: group,
                        value: count,
                        platform: platform
                    }))
                }))
            };

            // Create hierarchy
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.value)
                .sort((a, b) => b.value - a.value);

            // Create partition layout
            const partition = d3.partition()
                .size([2 * Math.PI, radius]);

            partition(root);

            // Track current focused node
            let focusedNode = root;

            // Color scales for different platforms - improved palette with better contrast
            const platformColors = {
                'Newsletter - Substack': '#FF6B35',    // Vibrant orange
                'Newsletter - Beehiiv': '#F7931E',     // Golden orange
                'Newsletter - Other': '#FDB833',       // Warm yellow
                'Newsletter - Ghost': '#FFD23F',       // Bright yellow
                'Video - YouTube': '#E74C3C',          // YouTube red
                'Video - Instagram': '#E4405F',        // Instagram pink
                'Video - TikTok': '#00F2EA',           // TikTok cyan
                'Social - Twitter / X': '#1DA1F2',     // Twitter blue
                'Social - BlueSky': '#0560FF',         // BlueSky blue
                'Social - LinkedIn': '#0A66C2',        // LinkedIn blue
                'Social - Facebook': '#1877F2',        // Facebook blue
                'Podcast': '#9B59B6',                  // Purple
                'Website': '#16A085'                    // Teal/green
            };

            // Get default color if platform not in map
            function getPlatformColor(platform) {
                if (platformColors[platform]) return platformColors[platform];
                if (platform.includes('Newsletter')) return '#3b82f6';
                if (platform.includes('Video')) return '#ef4444';
                if (platform.includes('Social')) return '#8b5cf6';
                if (platform.includes('Podcast')) return '#9333ea';
                return '#97d600'; // Default acid green
            }

            // Create arc generator
            const arc = d3.arc()
                .startAngle(d => Math.max(0, Math.min(2 * Math.PI, d.x0)))
                .endAngle(d => Math.max(0, Math.min(2 * Math.PI, d.x1)))
                .padAngle(d => {
                    // Reduce padding for very small segments to keep them visible
                    const angleSize = d.x1 - d.x0;
                    if (angleSize < 0.05) return 0.001;
                    return Math.min((d.x1 - d.x0) / 2, 0.005);
                })
                .padRadius(radius / 2)
                .innerRadius(d => Math.max(0, d.y0))
                .outerRadius(d => Math.max(0, d.y1 - 1));

            // Draw arcs
            const path = g.selectAll('path')
                .data(root.descendants().filter(d => d.depth > 0))
                .enter()
                .append('path')
                .attr('class', 'sunburst-arc')
                .attr('d', arc)
                .attr('fill', d => {
                    if (d.depth === 1) {
                        return getPlatformColor(d.data.name);
                    } else {
                        const baseColor = getPlatformColor(d.data.platform);
                        return d3.color(baseColor).brighter(0.5);
                    }
                })
                .attr('opacity', 0.95)
                .style('cursor', 'pointer')
                .on('click', function(event, d) {
                    event.stopPropagation();
                    zoomTo(d);
                })
                .on('mouseover', function(event, d) {
                    d3.select(this)
                        .attr('opacity', 0.85)
                        .style('filter', 'brightness(1.15)');
                    showSunburstTooltip(event, d);
                })
                .on('mouseout', function(event, d) {
                    d3.select(this)
                        .attr('opacity', 0.95)
                        .style('filter', 'none');
                    hideSunburstTooltip();
                });

            // Add labels
            const labels = g.selectAll('text')
                .data(root.descendants().filter(d => d.depth > 0))
                .enter()
                .append('text')
                .attr('class', 'sunburst-label')
                .attr('transform', d => {
                    const angle = (d.x0 + d.x1) / 2 * 180 / Math.PI;
                    const radius = (d.y0 + d.y1) / 2;
                    return `rotate(${angle - 90}) translate(${radius},0) rotate(${angle < 180 ? 0 : 180})`;
                })
                .attr('dy', '0.35em')
                .attr('opacity', d => {
                    const angle = d.x1 - d.x0;
                    const radiusSize = d.y1 - d.y0;
                    return (angle > 0.1 && radiusSize > 30) ? 1 : 0;
                })
                .text(d => {
                    const name = d.data.name;
                    if (name.length > 12) return name.substring(0, 12) + '...';
                    return name;
                })
                .style('font-size', d => d.depth === 1 ? '11px' : '9px')
                .style('pointer-events', 'none');

            // Add center circle (clickable to zoom out)
            const centerGroup = g.append('g')
                .attr('class', 'sunburst-center-group')
                .style('cursor', 'pointer')
                .on('click', () => zoomTo(root));

            // Add subtle shadow/glow effect
            const defs = svg.append('defs');
            const filter = defs.append('filter')
                .attr('id', 'center-glow')
                .attr('x', '-50%')
                .attr('y', '-50%')
                .attr('width', '200%')
                .attr('height', '200%');
            
            filter.append('feGaussianBlur')
                .attr('in', 'SourceGraphic')
                .attr('stdDeviation', '3');

            centerGroup.append('circle')
                .attr('r', root.y0 + 15)
                .attr('fill', 'var(--white)')
                .attr('stroke', 'var(--black)')
                .attr('stroke-width', 3)
                .attr('filter', 'url(#center-glow)')
                .style('transition', 'all 0.3s ease');

            // Center text elements with improved spacing
            const centerText = centerGroup.append('g');
            
            // Add "BACK" indicator that shows on hover when zoomed in
            const backIndicator = centerText.append('text')
                .attr('class', 'sunburst-center-text sunburst-center-back')
                .attr('dy', '-2.5em')
                .style('font-size', '12px')
                .style('font-weight', '700')
                .style('letter-spacing', '1px')
                .style('fill', '#666')
                .text('√¢‚Ä†¬ê BACK');
            
            const titleText = centerText.append('text')
                .attr('class', 'sunburst-center-text')
                .attr('dy', '-1em')
                .style('font-size', '14px')
                .style('font-weight', '700')
                .style('letter-spacing', '2px')
                .style('fill', '#666')
                .text('ATLAS');

            const countText = centerText.append('text')
                .attr('class', 'sunburst-center-text')
                .attr('dy', '0.7em')
                .style('font-size', '48px')
                .style('font-weight', '900')
                .style('letter-spacing', '-2px')
                .text(filteredCreators.length);

            const labelText = centerText.append('text')
                .attr('class', 'sunburst-center-text')
                .attr('dy', '2.8em')
                .style('font-size', '13px')
                .style('font-weight', '600')
                .style('fill', '#666')
                .text('creators');

            // Zoom function
            function zoomTo(p) {
                focusedNode = p;

                // Update breadcrumb with home icon
                const breadcrumb = document.getElementById('sunburstBreadcrumb');
                let breadcrumbHTML = '<span class="breadcrumb-item" onclick="resetSunburst()" style="cursor: pointer;" title="Reset to view all creators">√∞≈∏¬è¬† All Creators</span>';
                
                if (p.depth >= 1) {
                    const platform = p.depth === 1 ? p : p.parent;
                    breadcrumbHTML += ' <span class="breadcrumb-separator">&rsaquo;</span> ';
                    breadcrumbHTML += `<span class="breadcrumb-item ${p.depth === 1 ? 'active' : ''}">${platform.data.name}</span>`;
                }
                
                if (p.depth === 2) {
                    breadcrumbHTML += ' <span class="breadcrumb-separator">&rsaquo;</span> ';
                    breadcrumbHTML += `<span class="breadcrumb-item active">${p.data.name}</span>`;
                }
                
                breadcrumb.innerHTML = breadcrumbHTML;

                // Update center text based on what's focused
                if (p === root) {
                    // At root - hide back indicator
                    backIndicator.style('opacity', '0');
                    titleText.text('ATLAS')
                        .style('font-size', '14px')
                        .style('letter-spacing', '2px')
                        .style('fill', '#666');
                    countText.text(filteredCreators.length)
                        .style('font-size', '48px')
                        .style('letter-spacing', '-2px');
                    labelText.text('creators')
                        .style('font-size', '13px');
                    hideCreators();
                } else if (p.depth === 1) {
                    // Platform level - show platform stats, hide creators, enable back indicator
                    backIndicator.style('opacity', '0.6');
                    const platformName = p.data.name.length > 12 ? p.data.name.substring(0, 12) + '...' : p.data.name;
                    titleText.text(platformName.toUpperCase())
                        .style('font-size', '12px')
                        .style('letter-spacing', '1px')
                        .style('fill', '#666');
                    countText.text(p.value)
                        .style('font-size', '48px')
                        .style('letter-spacing', '-2px');
                    labelText.text(`creators in ${p.children.length} topic${p.children.length !== 1 ? 's' : ''}`)
                        .style('font-size', '12px');
                    hideCreators();
                } else if (p.depth === 2) {
                    // Topic level - show topic stats and creators, enable back indicator
                    backIndicator.style('opacity', '0.6');
                    const topicName = p.data.name.length > 15 ? p.data.name.substring(0, 15) + '...' : p.data.name;
                    titleText.text(topicName.toUpperCase())
                        .style('font-size', '11px')
                        .style('letter-spacing', '0.5px')
                        .style('fill', '#666');
                    countText.text(p.value)
                        .style('font-size', '56px')
                        .style('letter-spacing', '-2px');
                    labelText.text(`creator${p.value !== 1 ? 's' : ''}`)
                        .style('font-size', '13px');
                    showCreatorsForSelection(p.data.platform, p.data.name);
                }

                root.each(d => d.target = {
                    x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    y0: Math.max(0, d.y0 - p.y0),
                    y1: Math.max(0, d.y1 - p.y0)
                });

                const t = g.transition()
                    .duration(750)
                    .ease(d3.easeCubicOut);

                // Transition arcs
                path.transition(t)
                    .tween('data', d => {
                        const i = d3.interpolate(d.current, d.target);
                        return t => d.current = i(t);
                    })
                    .attr('d', d => {
                        const arcGen = d3.arc()
                            .startAngle(d => d.x0)
                            .endAngle(d => d.x1)
                            .padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.005))
                            .padRadius(radius / 2)
                            .innerRadius(d => d.y0)
                            .outerRadius(d => d.y1 - 1);
                        return arcGen(d.current);
                    })
                    .attr('opacity', d => {
                        // Fade out arcs not in focused subtree with better contrast
                        return d.depth === 0 || (d.depth === 1 && p === root) || 
                               (p.depth === 1 && d.parent === p) ||
                               (p.depth === 2 && (d === p || d === p.parent)) ? 0.95 : 0.2;
                    });

                // Transition labels
                labels.transition(t)
                    .attr('transform', d => {
                        const angle = (d.current.x0 + d.current.x1) / 2 * 180 / Math.PI;
                        const radius = (d.current.y0 + d.current.y1) / 2;
                        return `rotate(${angle - 90}) translate(${radius},0) rotate(${angle < 180 ? 0 : 180})`;
                    })
                    .attr('opacity', d => {
                        if (d.depth === 0) return 0;
                        const angle = d.current.x1 - d.current.x0;
                        const radiusSize = d.current.y1 - d.current.y0;
                        const isInFocus = (p === root) || (d.parent === p) || (d === p) || (p.depth === 2 && d === p.parent);
                        return (angle > 0.1 && radiusSize > 30 && isInFocus) ? 1 : 0;
                    });
            }

            // Initialize current positions
            root.each(d => d.current = {
                x0: d.x0,
                x1: d.x1,
                y0: d.y0,
                y1: d.y1
            });

            // Build legend
            const uniquePlatforms = [...new Set(Object.keys(platformData))];
            const legendHTML = uniquePlatforms.map(platform => {
                const count = Object.values(platformData[platform]).reduce((a, b) => a + b, 0);
                return `
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: ${getPlatformColor(platform)}"></div>
                        <span>${platform} (${count})</span>
                    </div>
                `;
            }).join('');
            document.getElementById('sunburstLegend').innerHTML = legendHTML;
        }

        // Treemap Chart Rendering
        function renderTreemapChart() {
            const container = document.getElementById('treemapChart');
            container.innerHTML = ''; // Clear previous
            
            const width = container.clientWidth || 1000;
            const height = 600;
            
            // Build hierarchy: Groups ‚Üí Topics
            const hierarchy = buildTreemapHierarchy(filteredCreators);
            
            // Create SVG
            const svg = d3.select(container)
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            // Create treemap layout
            const treemap = d3.treemap()
                .size([width, height])
                .padding(2)
                .round(true);
            
            const root = d3.hierarchy(hierarchy)
                .sum(d => d.value || 0)
                .sort((a, b) => b.value - a.value);
            
            treemap(root);
            
            // Color scale for groups
            const groupColors = {
                'Power & Politics': '#FF6B6B',
                'Money & Work': '#4ECDC4',
                'Civic Life': '#45B7D1',
                'Social Issues': '#FFA07A',
                'Science, Health & Environment': '#98D8C8',
                'Culture & Media': '#F7B801',
                'Lifestyle & Personal Life': '#E056FD',
                'Journalism Formats': '#686DE0',
                'General News': '#95A5A6'
            };
            
            // Function to get color
            function getColor(d) {
                let group = d;
                while (group.depth > 1) {
                    group = group.parent;
                }
                const baseColor = groupColors[group.data.name] || '#666666';
                
                if (d.depth === 1) {
                    return baseColor;
                } else {
                    return d3.color(baseColor).brighter(0.5);
                }
            }
            
            // Create cells
            const cells = svg.selectAll('g')
                .data(root.descendants().filter(d => d.depth > 0))
                .enter()
                .append('g')
                .attr('class', 'treemap-cell')
                .attr('transform', d => `translate(${d.x0},${d.y0})`);
            
            // Add rectangles
            cells.append('rect')
                .attr('width', d => d.x1 - d.x0)
                .attr('height', d => d.y1 - d.y0)
                .style('fill', d => getColor(d))
                .style('stroke', '#fff')
                .style('stroke-width', d => d.depth === 1 ? '3px' : '1px')
                .style('cursor', 'pointer')
                .on('click', function(event, d) {
                    event.stopPropagation();
                    if (d.depth === 2) {
                        // Topic clicked - apply filter
                        activeFilters.topic.clear();
                        activeFilters.topic.add(d.data.name);
                        applyFilters();
                        updateURL();
                        toggleView('grid');
                    } else if (d.depth === 1) {
                        // Group clicked - apply filter
                        activeFilters.group.clear();
                        activeFilters.group.add(d.data.name);
                        applyFilters();
                        updateURL();
                        toggleView('grid');
                    }
                })
                .on('mouseover', function(event, d) {
                    d3.select(this)
                        .style('opacity', 0.8)
                        .style('stroke-width', d.depth === 1 ? '4px' : '2px');
                    showTreemapTooltip(event, d);
                })
                .on('mouseout', function(event, d) {
                    d3.select(this)
                        .style('opacity', 1)
                        .style('stroke-width', d.depth === 1 ? '3px' : '1px');
                    hideTreemapTooltip();
                });
            
            // Add labels
            cells.append('text')
                .attr('class', 'treemap-label')
                .attr('x', 4)
                .attr('y', 16)
                .style('font-size', d => {
                    const width = d.x1 - d.x0;
                    const height = d.y1 - d.y0;
                    const area = width * height;
                    
                    if (d.depth === 1) {
                        return area > 15000 ? '16px' : area > 5000 ? '14px' : '12px';
                    } else {
                        return area > 10000 ? '12px' : area > 3000 ? '10px' : '9px';
                    }
                })
                .style('font-weight', d => d.depth === 1 ? '700' : '600')
                .style('fill', d => {
                    const color = d3.color(getColor(d));
                    return color.l < 0.5 ? '#fff' : '#000';
                })
                .style('pointer-events', 'none')
                .text(d => {
                    const width = d.x1 - d.x0;
                    const maxChars = Math.floor(width / 8);
                    const name = d.data.name;
                    return name.length > maxChars ? name.substring(0, maxChars - 3) + '...' : name;
                });
            
            // Add count labels for larger cells
            cells.filter(d => (d.x1 - d.x0) > 80 && (d.y1 - d.y0) > 40)
                .append('text')
                .attr('class', 'treemap-count')
                .attr('x', 4)
                .attr('y', d => (d.y1 - d.y0) - 6)
                .style('font-size', '11px')
                .style('font-weight', '400')
                .style('fill', d => {
                    const color = d3.color(getColor(d));
                    return color.l < 0.5 ? 'rgba(255,255,255,0.8)' : 'rgba(0,0,0,0.6)';
                })
                .style('pointer-events', 'none')
                .text(d => `${d.value} creator${d.value !== 1 ? 's' : ''}`);
        }

        function buildTreemapHierarchy(creators) {
            const hierarchy = {
                name: 'root',
                children: []
            };
            
            const byGroup = {};
            creators.forEach(creator => {
                const group = creator.group || 'Uncategorized';
                if (!byGroup[group]) {
                    byGroup[group] = {};
                }
                
                const topic = creator.topic || 'Other';
                if (!byGroup[group][topic]) {
                    byGroup[group][topic] = [];
                }
                
                byGroup[group][topic].push(creator);
            });
            
            const orderedGroups = [
                'Power & Politics',
                'Money & Work',
                'Civic Life',
                'Social Issues',
                'Science, Health & Environment',
                'Culture & Media',
                'Lifestyle & Personal Life',
                'Journalism Formats',
                'General News'
            ];
            
            orderedGroups.forEach(group => {
                if (!byGroup[group]) return;
                
                const groupNode = {
                    name: group,
                    children: []
                };
                
                Object.keys(byGroup[group]).sort().forEach(topic => {
                    const creators = byGroup[group][topic];
                    groupNode.children.push({
                        name: topic,
                        value: creators.length,
                        creators: creators
                    });
                });
                
                hierarchy.children.push(groupNode);
            });
            
            Object.keys(byGroup).forEach(group => {
                if (!orderedGroups.includes(group)) {
                    const groupNode = {
                        name: group,
                        children: []
                    };
                    
                    Object.keys(byGroup[group]).sort().forEach(topic => {
                        const creators = byGroup[group][topic];
                        groupNode.children.push({
                            name: topic,
                            value: creators.length,
                            creators: creators
                        });
                    });
                    
                    hierarchy.children.push(groupNode);
                }
            });
            
            return hierarchy;
        }

        function showTreemapTooltip(event, d) {
            let tooltip = document.querySelector('.treemap-tooltip');
            if (!tooltip) {
                tooltip = document.createElement('div');
                tooltip.className = 'treemap-tooltip';
                document.body.appendChild(tooltip);
            }
            
            const label = d.depth === 1 ? 'Group' : 'Topic';
            
            tooltip.innerHTML = `
                <strong>${label}: ${d.data.name}</strong><br>
                ${d.value} creator${d.value !== 1 ? 's' : ''}<br>
                <span style="opacity: 0.7; font-size: 11px;">Click to filter</span>
            `;
            
            tooltip.style.display = 'block';
            tooltip.style.left = (event.pageX + 10) + 'px';
            tooltip.style.top = (event.pageY + 10) + 'px';
        }

        function hideTreemapTooltip() {
            const tooltip = document.querySelector('.treemap-tooltip');
            if (tooltip) {
                tooltip.style.display = 'none';
            }
        }

        function resetSunburst() {
            // Full reset - clear all filters
            activeFilters.platform.clear();
            activeFilters.geography.clear();
            activeFilters.topic.clear();
            activeFilters.search = '';
            
            // Clear search input
            document.getElementById('navSearch').value = '';
            
            // Uncheck all sidebar checkboxes
            document.querySelectorAll('.filter-checkbox').forEach(cb => cb.checked = false);
            
            // Reset filtered creators to all creators
            filteredCreators = [...allCreators];
            
            // Update results count
            updateResultsCount();
            
            // Re-render current view
            if (currentView === 'grid') {
                renderGridView();
            } else if (currentView === 'list') {
                renderListView();
            } else if (currentView === 'bubbles') {
                renderBubbleChart();
            }
            
            // Re-render sunburst with all data
            renderSunburstChart();
            
            // Update URL to remove filters
            updateURL();
        }

        function showCreatorsForSelection(platform, topic) {
            const creatorsContainer = document.getElementById('sunburstCreators');
            
            // Filter creators
            let selectedCreators = filteredCreators.filter(c => {
                if (topic) {
                    return c.platform === platform && c.topic === topic;
                } else {
                    return c.platform === platform;
                }
            });

            if (selectedCreators.length === 0) {
                creatorsContainer.innerHTML = '<p style="text-align: center; color: #666;">No creators found</p>';
                creatorsContainer.classList.add('active');
                return;
            }

            // Build creator cards
            const cardsHTML = selectedCreators.map(creator => {
                const initials = creator.name
                    .split(' ')
                    .map(word => word[0])
                    .join('')
                    .substring(0, 2)
                    .toUpperCase();

                return `
                    <div class="sunburst-creator-card" onclick="window.open('${creator.link}', '_blank')">
                        <div class="sunburst-creator-avatar">${initials}</div>
                        <div class="sunburst-creator-name">${creator.name}</div>
                        <div class="sunburst-creator-channel">${creator.channel || 'Creator'}</div>
                    </div>
                `;
            }).join('');

            creatorsContainer.innerHTML = cardsHTML;
            creatorsContainer.classList.add('active');
        }

        function hideCreators() {
            document.getElementById('sunburstCreators').classList.remove('active');
        }

        function showSunburstTooltip(event, d) {
            const tooltip = document.getElementById('sunburstTooltip');
            
            if (d.depth === 1) {
                // Platform level
                const groupCount = d.children.length;
                const percentage = ((d.value / filteredCreators.length) * 100).toFixed(1);
                tooltip.innerHTML = `
                    <div style="font-weight: 700; font-size: 14px; margin-bottom: 4px;">${d.data.name}</div>
                    <div style="font-size: 13px; color: #666;">${d.value} creators (${percentage}%)</div>
                    <div style="font-size: 12px; color: #999; margin-top: 2px;">${groupCount} group${groupCount !== 1 ? 's' : ''}</div>
                `;
            } else if (d.depth === 2) {
                // Group level (outer ring)
                const percentage = ((d.value / filteredCreators.length) * 100).toFixed(1);
                tooltip.innerHTML = `
                    <div style="font-size: 12px; color: #999;">${d.data.platform}</div>
                    <div style="font-weight: 700; font-size: 14px; margin: 2px 0 4px 0;">${d.data.name}</div>
                    <div style="font-size: 13px; color: #666;">${d.value} creator${d.value !== 1 ? 's' : ''} (${percentage}%)</div>
                `;
            }
            
            tooltip.style.left = (event.pageX + 15) + 'px';
            tooltip.style.top = (event.pageY - 15) + 'px';
            tooltip.style.opacity = 1;
        }

        function hideSunburstTooltip() {
            document.getElementById('sunburstTooltip').style.opacity = 0;
        }
    </script>

    <!-- Mobile Menu JavaScript -->
    <script>
    // Mobile Menu Toggle
    (function() {
        const menuButton = document.getElementById('mobileMenuButton');
        const mobileMenu = document.getElementById('mobileMenu');
        const menuOverlay = document.getElementById('mobileMenuOverlay');
        const menuClose = document.getElementById('mobileMenuClose');
        
        function openMenu() {
            mobileMenu.classList.add('active');
            menuOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeMenu() {
            mobileMenu.classList.remove('active');
            menuOverlay.classList.remove('active');
            document.body.style.overflow = '';
        }
        
        if (menuButton) {
            menuButton.addEventListener('click', openMenu);
        }
        
        if (menuClose) {
            menuClose.addEventListener('click', closeMenu);
        }
        
        if (menuOverlay) {
            menuOverlay.addEventListener('click', closeMenu);
        }
        
        // Close menu on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && mobileMenu.classList.contains('active')) {
                closeMenu();
            }
        });
    })();
    </script>

</body>
</html>
